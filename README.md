# 一筆書きパズル プリセット生成ツール

## 概要
このワークスペースには、一筆書きパズルプロジェクトのプリセットを生成するための小さなNode.jsユーティリティが含まれています。エントリーポイントは `preset_tools/generate_preset.js` で、長い経路を長方形のグリッド上で探索し、パズルプリセットを作成するための統計情報を出力します。

## 必要条件
- Node.js 18以上（スクリプトは組み込みの `node:perf_hooks` モジュールを使用）
- 追加のnpm依存関係は不要

## はじめに
リポジトリのルートから、Nodeを使用してプリセット生成ツールを実行します：

```sh
node preset_tools/generate_preset.js [options]
```

オプションの完全なリストを確認するには、以下を実行してください：

```sh
node preset_tools/generate_preset.js --help
```

## 主なオプション
CLIは以下のフラグを受け付けます：

| フラグ | 説明 | デフォルト |
| ---- | ----------- | ------- |
| `--start ROW,COL` | 開始セルの座標 | `0,0` |
| `--goal ROW,COL` | ゴールセルの座標 | `rows-1,cols-1` |
| `--blocked LIST` | ブロックされたセルのリスト（各セルは `ROW,COL` 形式でセミコロン区切り） | _(なし)_ |
| `--rows N` | グリッドの行数 | `10` |
| `--columns N` | グリッドの列数 | `10` |
| `--max-attempts N` | ランダム探索の最大試行回数 | `40` |
| `--max-time MS` | ミリ秒単位の全体の時間制限 | `5000` |
| `--max-backtracks N` | 1回の試行でのバックトラックの上限 | `60000` |
| `--goal-gap N` | ゴール到達時に許容される未訪問セルの最大数 | `2` |
| `--target-visited N` | ゴール到達前に訪問する目標セル数 | _(自動計算)_ |
| `-h`, `--help` | ヘルプテキストを表示 | _(オフ)_ |

### `--blocked` について
- このフラグには、セミコロンで区切られた座標のリストを1つの文字列として指定します。例：`--blocked "1,2;3,4;5,6"`
- 各座標は2つの整数（行が先、列が後）で指定します。
- ブロックされたセルはすべて、`--rows` および `--columns` で定義されたグリッド内に収まる必要があります。
- 開始セルまたはゴールセルがブロックリストに含まれている場合、試行は即座に失敗します。

## 使用例
カスタムの開始/ゴール座標を使用して10x10のプリセットを生成：

```sh
node preset_tools/generate_preset.js \
  --rows 10 --columns 10 \
  --start 0,0 --goal 9,9 \
  --max-attempts 80 --max-time 8000
```

6x6のグリッドで3つのセルをブロックし、長い経路を探索：

```sh
node preset_tools/generate_preset.js \
  --rows 6 --columns 6 \
  --start 0,0 --goal 5,5 \
  --blocked "1,1;2,3;4,0" \
  --target-visited 20 \
  --goal-gap 10
```

## 出力
成功した場合、スクリプトはテキスト形式の概要を出力し、その後に以下を含むJSONオブジェクトを出力します：
- グリッドサイズと座標データ
- 経路統計情報（訪問セル数、ターン数、エントロピーメトリクスなど）
- 提案された壁（未訪問セル）
- 探索診断情報（試行回数と経過時間）

探索が制限を超えても満足のいく経路が見つからない場合、JSON出力には `reason: "no-path-found"` が記録されます。

## ヒント
- `--max-time`、`--max-attempts`、または `--max-backtracks` の値が小さすぎると、早期終了する可能性があります。大きなグリッドを探索する場合はこれらを増やしてください。
- `--goal-gap` と `--target-visited` を調整して、ほぼハミルトン経路を探索したり、壁のための意図的なギャップを残したりできます。
- JSONの概要をファイルにリダイレクトしてさらに分析することができます。例：`node preset_tools/generate_preset.js ... > preset.json`。

## ローカルサーバーでの動作確認（VSCodeのLive Serverを使用）

このプロジェクトでは、VSCodeの拡張機能「Live Server」を使用してローカルサーバーを立て、アプリケーションの動作を確認することができます。以下の手順に従ってください：

### 必要なツール
- Visual Studio Code（VSCode）
- Live Server拡張機能

### 手順
1. VSCodeを開き、プロジェクトのルートディレクトリを開きます：

   ```
   {to_your_path}/one_stroke_puzzle
   ```

2. Live Server拡張機能をインストールします：
   - VSCodeの拡張機能ビュー（左側の四角いアイコン）を開きます。
   - 検索バーに「Live Server」と入力し、`Ritwick Dey`が提供する拡張機能をインストールします。

3. `index.html` ファイルをエディタで開きます。

4. 右下のステータスバーにある「Go Live」ボタンをクリックします。
   - または、右クリックメニューから「Open with Live Server」を選択します。

5. ブラウザが自動的に開き、以下のURLにアクセスします：

   ```
   http://127.0.0.1:5500
   ```

   これで、プロジェクトの`index.html`が読み込まれ、アプリケーションの動作を確認できます。

### 注意事項
- デフォルトではポート`5500`が使用されますが、設定で変更可能です。
- サーバーを停止するには、VSCodeの右下にある「Port: 5500」ボタンをクリックして「Stop Live Server」を選択してください。
- Live Serverは開発目的でのみ使用してください。
